{% load i18n %}
{% load staticfiles %}

{% if debug_json_ and user.is_staff %}
  <pre style="background-color: #cbb;">
{{ debug_json }}
  </pre>
{% endif %}

<div class="file-evaluation-widget">
  {# Tab selector for tests #}
  <div class="test-tab-selector-box">
    {% for test_info in evaluation_tree.tests|dictsort:"test_id" %}<div class="test-tab-selector {% if test_info.correct %}correct-test{% else %}incorrect-test{% endif %}" onclick="activate_test_tab({{ test_info.test_id }});">
        {{ test_info.name }}
        {% if test_info.correct %}
          <img src="{% static 'courses/correct-16.png' %}" alt="{% trans 'Correct' %}">
        {% else %}
          <img src="{% static 'courses/incorrect-16.png' %}" alt="{% trans 'Incorrect' %}">
        {% endif %}
      </div>{% endfor %}
  </div>

  {% for test_info in evaluation_tree.tests|dictsort:"test_id" %}
    {# One tab, named after the test name, for each test #}
    <div class="test-evaluation-tab" id="file-test-{{ test_info.test_id }}" style="display: none;">
      {% for stage_info in test_info.stages|dictsort:"ordinal_number" %}
        <div class="test-evaluation-stage">{{ stage_info.name }}</div>
        {% for cmd_info in stage_info.commands|dictsort:"ordinal_number" %}
          <div class="test-evaluation-commands">Command</div>
          <pre>{{ cmd_info.command_line }}</pre>
          {% if cmd_info.expected_retval != None %}
            <div class="test-evaluation-retval {% if cmd_info.retval == cmd_info.expected_retval %}retval-correct{% else %}retval-incorrect{% endif %}">
              Exited with return value {{ cmd_info.retval }}, while the expected return
              value was {{ cmd_info.expected_retval }}.
            </div>
          {% endif %}

          {% if cmd_info.stdout_diff %}
            <div>
              {{ cmd_info.stdout_diff|safe }}
            </div>
          {% endif %}
          {% if cmd_info.stderr_diff %}
            <div>
              {{ cmd_info.stderr_diff|safe }}
            </div>
          {% endif %}
        {% endfor %}
      {% endfor %}
    </div>
  {% endfor %}
</div>
