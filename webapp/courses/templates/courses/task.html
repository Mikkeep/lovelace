{% load staticfiles %}
{% load content_extra %}
{% if tasktype %}
  {% content_meta course_slug content user evaluation %}

  {% if emb_content %}
    <div>{{ emb_content|safe }}</div>
  {% endif %}
  <div class="question">
    <form id="{{ content_slug }}-form" class="exercise-form" method="POST" enctype="multipart/form-data"
          action="{% url 'courses:check' course_slug content_slug %}">
      {% csrf_token %}
      {% if question %}{{ question|safe }}{% endif %}
      {% if tasktype == "MULTIPLE_CHOICE_EXERCISE" %}
        {% for choice in choices %}
          <div class="input-label-container">
            <input type="radio" name="{{ content_slug }}-radio" id="mce-{{ choice.id }}" value="{{ choice.id }}" class="task_radio"><label for="mce-{{ choice.id }}">{{ choice.answer }}</label>
          </div>
        {% endfor %}
      {% elif tasktype == "CHECKBOX_EXERCISE" %}
        {% for choice in choices %}
          <div class="input-label-container">
            <input type="checkbox" name="{{ choice.id }}" id="cb-{{ choice.id }}" value="{{ choice.id }}" class="task_check"><label for="cb-{{ choice.id }}">{{ choice.answer }}</label>
          </div>
        {% endfor %}
      {% elif tasktype == "TEXTFIELD_EXERCISE" %}
        <textarea name="answer" class="task_text" placeholder="Enter your answer here" rows="3"></textarea><br>
      {% elif tasktype == "FILE_UPLOAD_EXERCISE" %}
        <div class="input-label-container"><label for="collaborators" class="file">Collaborators:</label><input name="collaborators" type="text" size="60" class="task_file" placeholder="Who did you co-operate with?"></div>
        <div class="input-label-container"><label for="file" class="file">Submit your files here:</label><input name="file" type="file" class="task_file" multiple="multiple"></div>
        {% comment %}Use the accept and multiple properties for the file!{% endcomment %}
      {% elif tasktype == "CODE_REPLACE_EXERCISE" %}
        {% for replace_file, lineiter in choices %}
          <div>
            <div class="code-replace-filename">{{ replace_file }}</div>
            {% for _, replace_line, id in lineiter %}
              <div class="input-label-container code-replace">
                <label for="cre-{{ id }}" class="code-replace-label"
                       title="Line {{ replace_line }} in {{ replace_file }}"
                       onmouseover="highlight_code_line('{{ replace_file }}', {{ replace_line }});"
                       onmouseout="unhighlight_code_line('{{ replace_file }}', {{ replace_line }});">
                  {{ replace_line }}
                </label>
                <input id="cre-{{ id }}" name="cre-{{ id }}" type="text" class="code-replace-input">
              </div>
            {% endfor %}
          </div>
        {% endfor %}
      {% endif %}
      
      <input type="submit" name="submit" value="Send answer">
      {% if not user.is_authenticated %}
        <div class="auth_warning">Warning: You have not logged in. Your answer will not be saved.</div>
      {% endif %}
      {% if evaluation == "not_answered" %}
        <div class="answered_status"></div>
      {% elif evaluation == "incorrect" %}
        <div class="answered_status"><span class="incorrect">You have previously answered this task incorrectly.</span></div>
      {% elif evaluation == "correct" %}
        <div class="answered_status"><span class="correct">You have already answered this task correctly.</span></div>
      {% endif %}
    </form>
    <div class="error" style="display: none"></div>
    <div class="result" style="display: none"></div>
  </div>  
{% endif %}
