{% load staticfiles %}
<DOCTYPE html>
  <html>
    <head>
      <title></title>
      <script src="{% static 'courses/jquery-2.1.1.min.js' %}"></script>
      <style>
        table {
          border-collapse: collapse;
        }
        
        table th.empty {
          border: 0;
        }

        table tr.even-row {
          background: rgba(191, 191, 191, 0.5);
        }
        table tr.odd-row {
          background: rgba(255, 255, 255, 0.5);
        }

        table col.even-col {
          background: rgba(191, 191, 191, 0.5);
        }
        table col.odd-col {
          background: rgba(255, 255, 255, 0.5);
        }
        
        table td {
          border: 1px solid #aaa;
          padding: 2px;
          width: 26px;
          text-align: center;
        }

        table th.username {
          border: 1px solid #aaa;
          padding: 2px;
        }
        table th.staff {
          color: #f00;
        }
        
        span.light {
          color: #999;
        }
        
        th.rotate {
          height: 260px;
          white-space: nowrap;
          background: #fff;
        }
        
        th.rotate > div {
          transform: 
            /* Magic Numbers */
            translate(17.5px, 112.5px)
            /* 45 is really 360 - 45 */
            rotate(315deg);
          width: 26px;
        }
        
        th.rotate > div > span {
          border-bottom: 1px solid #999;
          padding: 0px 4px 1px 4px;
          width: 260px;
        }

        tr:hover {
          background-color: rgba(0, 191, 0, 0.5) !important;
        }
      </style>
      <script>
        function cursor_highlight(cell) {
          var col = cell.getAttribute("data-col");
          $("col.col-" + col).css("background-color", "rgba(0, 191, 0, 0.5)");
        }
        function cursor_dehighlight(cell) {
          var col = cell.getAttribute("data-col");
          $("col.col-" + col).css("background-color", "");
        }
      </script>
    </head>
    <body>
      <h1>All users, course {{ course.name }}</h1>
      <table>
        {% for row_cell in table_rows.0 %}
          <col class="col-{{ forloop.counter0 }} {% cycle 'odd-col' 'even-col' %}">
        {% endfor %}
        <tr>
          <th class="empty"></th>
          {% for exercise in exercises %}
          <th class="rotate">
            <div><span style="background: {{ exercise.0 }};">{{ exercise.1.name }}</span></div>
          </th>
          {% endfor %}
        </tr>
        {% for table_row in table_rows %}
        <tr class="{% cycle 'odd-row' 'even-row' %}">
          {% for row_cell in table_row %}
            {% if forloop.first %}
              <th class="username{% if row_cell.is_staff %} staff{% endif %}">
                {{ row_cell.username }}
              </th>
            {% else %}
              <td onMouseOver="cursor_highlight(this);"
                  onMouseOut="cursor_dehighlight(this);"
                  data-col="{{ forloop.counter0 }}">
                {% if row_cell == "unanswered" %}
                  <span class="light">?</span>
                {% elif row_cell == "incorrect" %}
                  0
                {% elif row_cell == "correct" %}
                  <b>1</b>
                {% else %}
                  {{ row_cell }}
                {% endif %}
              </td>
            {% endif %}
          {% endfor %}
        </tr>
        {% endfor %}
      </table>
    </body>
  </html>
