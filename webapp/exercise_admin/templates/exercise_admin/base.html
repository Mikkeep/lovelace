<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    {% load staticfiles %}
    {% load i18n %}
    <title>Edit | {{ exercise.name }}</title>
    <!--<link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Inconsolata">-->

    <link rel="stylesheet" href="{% static 'courses/jquery-ui.css' %}">
    <link rel="stylesheet" href="{% static 'courses/jquery-ui.structure.css' %}">
    <link rel="stylesheet" href="{% static 'courses/jquery-ui.theme.css' %}">
    <link rel="stylesheet" href="{% static 'courses/latofonts.css' %}">
    <link rel="stylesheet" href="{% static 'exercise_admin/exercise-admin.css' %}">

    <script src="{% static 'courses/jquery-3.0.0-beta1.min.js' %}"></script>
    <script src="{% static 'courses/jquery-ui.min.js' %}"></script>
    <script src="{% static 'courses/jquery.slimscroll.min.js' %}"></script>
    <script src="{% static 'exercise_admin/exercise-admin.js' %}"></script>
    {% block head-script %}
    {% endblock %}
  </head>
  <body>
    {% block heading %}
    {% endblock %}

    {% block meta %}
    {% endblock %}

    <form method="POST" action="{% url 'exercise_admin:edit_feedback_questions' %}" id="edit-feedback-form" onsubmit="submit_edit_feedback_form(event);">
      {% csrf_token %}
      <div id="edit-feedback-popup" class="popup">
        <div>
          <div id="add-feedback-div">
            <h2>Add feedback question</h2>
            <div class="bordered-editable-area">
              <div class="feedback-table-div">
                <table id="add-feedback-table" class="feedback-question-table">
                  <colgroup>
                    <col class="feedback-question">
                    <col class="feedback-type">
                    <col class="feedback-edit-button">
                  </colgroup>
                  <thead>
                    <tr>
                      <th>
                        <input type="checkbox" id="fb-question-checkbox-all" class="feedback-question-checkbox" onclick="select_all_feedback_questions(this.checked);">
                        <label for="fb-question-checkbox-all" class="feedback-question-label">Question</label>
                      </th>
                      <th>Type</th>
                    </tr>
                  </thead>
                  <tbody>
                  </tbody>
                </table>
              </div>
            </div>
          </div>

          <div id="edit-feedback-div">
            <h2 id="edit-feedback-div-title">Edit feedback question:</h2>
            <div id="edit-feedback-question-inputs">
            </div>
            <div id="feedback-choice-container" class="bordered-editable-area">
            </div>
            <button type="button" id="add-feedback-choice" class="add-item" title="Adds a new answer choice for the feedback question"
                    onclick="add_choice_to_selected_feedback();">Add choice</button>
            <button type="button" class="add-item" value="Done editing" title="Closes edit feedback menu" onclick="close_edit_feedback_menu();">Done editing</button>
            <div id="feedback-error" class="admin-error"></div>
          </div>

          <div id="create-feedback-div">
            <h2>Create new feedback question</h2>
            <div>
              <label class="feedback-question-input-label" for="feedback-question-new">
                <span class="feedback-question-span">Feedback question:</span>
                <input type="text" id="feedback-question-new" class="feedback-question-input" maxlength="100" oninput="update_create_feedback_button_state();">
              </label>
            </div>
            <div id="new-feedback-question-error" class="admin-error"></div>
            <div>
              <select id="feedback-type-select" class="feedback-type-select" onchange="handle_feedback_type_selection(this);" form="create-feedback-form">
                <option value="THUMB_FEEDBACK">Thumb feedback question</option>
                <option value="STAR_FEEDBACK">Star feedback question</option>
                <option value="MULTIPLE_CHOICE_FEEDBACK">Multiple choice feedback question</option>
                <option value="TEXTFIELD_FEEDBACK">Textfield feedback question</option>
              </select>
              <div id="new-feedback-choice-container" class="bordered-editable-area">
                <div id="new-feedback-choices" class="feedback-choices">
                </div>
              </div>
              <button type="button" id="add-new-feedback-choice" class="add-item" title="Adds a new answer choice for the feedback question"
                      onclick="add_feedback_choice('new-feedback-choice', 'choice_field', 'new-feedback-choice-container', 'new-feedback-choices', false);">Add choice</button>
              <button type="button" id="create-feedback-button" class="add-item" title="Creates a new feedback question"
                      onclick="create_new_feedback_question_entry();" disabled>Create feedback</button>
            </div>
          </div>
          <div class="popup-buttons">
            <input type="submit" class="popup-button" value="Save changes & Confirm selection" name="save_and_confirm">
            <button type="button" class="popup-button" onclick="close_popup($('#edit-feedback-popup'))">Cancel</button>
          </div>
        </div>
      </div>
    </form>

    <form method="POST" action="{% block form-action-url %}{% endblock %}" id="main-form" onSubmit="submit_main_form(event);">
      {% csrf_token %}
      <section class="general-information">
        <div class="generalinfo-left-side">
          <h2>General information</h2>

          <div class="form-row">
            <label for="exercise-name">Name:</label>
            <input type="text" id="exercise-name" name="exercise-name" value="{{ exercise.name }}" onInput="exercise_name_changed(event);" autofocus>
          </div>

          <div class="form-row">
            <label for="exercise-slug">Slug:</label>
            <span id="exercise-slug">{{ exercise.slug }}</span>
          </div>

          <div class="form-bigrow">
            <label for="exercise-page-content">Page contents in <a href="{% url 'courses:markup_help' %}" class="help-link" title="Help on how to edit with the markup language" target="_new">the markup language</a>:</label>
            <textarea id="exercise-page-content" name="exercise-page-content" cols="100" rows="8" onInput="exercise_page_content_changed(event);">{{ exercise.content }}</textarea>
          </div>
          
          <div class="form-bigrow">
            <label for="exercise-question">The exercise question:</label>
            <textarea id="exercise-question" name="exercise-question" cols="100" rows="3">{{ exercise.question }}</textarea>
          </div>

          <div class="form-row">
            <label for="exercise-points">Default points:</label>
            <input type="number" step="1" id="exercise-points" name="exercise-points" value="{{ exercise.default_points }}">
          </div>

          <div class="form-cb-row">
            <input type="checkbox" id="manually_evaluated" name="manually_evaluated">
            <label for="manually_evaluated">This exercise is evaluated by hand</label>
          </div>

          <div class="form-cb-row">
            <input type="checkbox" id="ask_collaborators" name="ask_collaborators">
            <label for="ask_collaborators">Ask the answerer to list collaborators</label>
          </div>

          {% block exercise-type-extra %}
          {% endblock %}
        </div>
        
        <div class="generalinfo-right-side">
          <h2>Feedback questions</h2>
          <div class="bordered-editable-area">
            <div id="feedback-question-table" class="feedback-table-div">
              <table class="feedback-question-table">
                <colgroup>
                  <col class="feedback-question">
                  <col class="feedback-type">
                  <col class="delete-feedback">
                </colgroup>
                <thead>
                  <tr>
                    <th>Question</th>
                    <th>Type</th>
                  </tr>
                </thead>
                <tbody>
                  {% for question in exercise.feedback_questions.all %}
                    <tr>
                      <td class="question-cell">{{ question }}</td>
                      <td class="type-cell">{{ question.get_human_readable_type }}</td>
                      <td class="delete-cell">
                        <button type="button" class="delete-button" title="Deletes the relation between the feedback question and the exercise"
                                onclick="delete_feedback_from_table(this);">x</button>
                      </td>
                    </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
          </div>
          <button type="button" class="add-item" title="Add and edit feedback questions"
                  onclick="show_edit_feedback_questions_popup(event, '{% url 'exercise_admin:get_feedback_questions' %}');">Add and Edit</button>
          <span id="edit-feedback-popup-error" class="admin-error"></span>

          <div class="separator"></div>

          <h2>Tags</h2>
          <ul class="exercise-tags">
            {% for ex_tag in exercise.tags %}
              <li class="exercise-tag">
                <input type="text" id="exercise-tag-{{ forloop.counter0|add:"1" }}" class="exercise-tag-input" name="exercise_tag_{{ forloop.counter0|add:"1" }}"
                       value="{{ ex_tag }}" maxlength="32" onfocus="highlight_parent_li(this);" oninput="change_tag_width(this);">
                <button type="button" class="delete-button" onclick="remove_tag(this);">x</button>
              </li>
            {% endfor %}
          </ul>
          <button type="button" class="add-item" onclick="add_tag();">Add</button>
        </div>
      </section>

      <section class="configurable-hints">
        <h2>Configurable hints</h2>

        <ul>
          {% for hint in hints %}
            <li>{{ hint.hint }}</li>
          {% endfor %}
        </ul>
      </section>

      {% block exercise-type-specific %}
      {% endblock %}

      {% block form-controls %}
      {% endblock %}
    </form>
  </body>
</html>
    
